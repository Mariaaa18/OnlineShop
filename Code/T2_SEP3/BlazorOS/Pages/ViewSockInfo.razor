@page "/ViewSockInfo/{id:int}"
@using global::Shared.Models
@using HttpClients.ClientInterfaces
@using global::Shared.DTOs
@inject ISockCardService cardService
@inject ISockInventoryService inventoryService
@inject ISocksService socksService


<div style="display: inline">
    <img class="sockImg" src=@card.Image/>

    <div class="sockInfo">
        <h4>@card.Title</h4>
        <b><label id="price-label">@card.Price â‚¬</label></b>
        <p>@card.Description</p>
        <p>Material: @card.Material</p>
        <p>Brand: @card.Brand</p>
        <p>Type: @card.Type</p>
        <p>Color: @selectedColor</p>
        <div class="color-container">
            @foreach (string color in colors)
            {
                <div class="colorBtn" style="background-color: @color; width: 25px" @onclick="() => { selectedColor=color; LoadSizes();}"></div>
            }
        </div><br/><br/>
        <p>Size: @selectedSizes</p>
        <div class="size-container">
            @foreach (string s in sizes)
            {
                <div class="sizeBtn" @onclick="() => { selectedSizes = s; }" >@s</div>

            }
        </div>
        
        <br/><br/>
        
        <button onclick="AddToCart" class="myButton">Add to the cart</button>

        <button @onclick="AddToCart">Add to the cart</button>
        @errorMsg
    </div>
</div>



@code {
    [Parameter]
    public int Id { get; set; }
    
    private string errorMsg = "";
    private SocksCard card=null!;
    private ICollection<String> colors { get; set; }=new List<string>();
    private String selectedColor;
    private ICollection<String> sizes{ get; set; }=new List<string>();
    private String selectedSizes;
    private ICollection<Inventory> inventories { get; set; }=new List<Inventory>();


    protected override async Task OnInitializedAsync()
    {
        try
        {
            card = await cardService.GetById(Id);
            inventories = await inventoryService.GetByCardIdAsync(card.Id);
            LoadColors();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            errorMsg = e.Message;
        }
    }

    private void LoadColors()
    {
        foreach (Inventory i in inventories)
        {
            if (!colors.Contains(i.Color))
            {
                colors.Add(i.Color);
            }
        }
        
    }
    
    
    private void LoadSizes()
    {
        sizes.Clear();
        foreach (var i in inventories)
        {
            if (selectedColor.Equals(i.Color))
            {
                if (!sizes.Contains(i.Size))
                {
                    sizes.Add(i.Size);
                }
            }
        }
    }

    private void AddToCart()
    {
        CreateSocksDto socks = new CreateSocksDto(card.Id, selectedSizes, selectedColor);
        socksService.CreateAsync(socks);
    }
}